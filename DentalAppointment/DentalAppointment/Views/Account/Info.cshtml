@using BLL.Services
@using Microsoft.IdentityModel.Tokens
@model System.Collections.Generic.List<Core.Models.Appointment>
@inject AppointmentService AppointmentService;
@{
    ViewBag.Title = "Info";
    Layout = "_Layout";
}

@{
    var nearestAppointment = AppointmentService.GetNearestAppointment();
    var plannedAppointments = AppointmentService.GetPlannedAppointments();
    var currentAppointments = AppointmentService.GetCurrentAppointments();
    var finishedAppointments = AppointmentService.GetFinishedAppointments();
}

<div class="container">
    <h2>Appointments</h2>
    
    @if (nearestAppointment != null)
    {
        var nearestDoctorFullName = $"{nearestAppointment.Doctor.Surname} {nearestAppointment.Doctor.Name} {nearestAppointment.Doctor.MiddleName}";
        var nearesDoctorSpec = nearestAppointment.Doctor.Specialization;
        var nearesDate = nearestAppointment.AppointmentDate.Date.ToString("dd.MM.yyyy");
        var nearesTime = nearestAppointment.AppointmentTime.ToString();
            
        <div class="row">
            <h2>Nearest</h2>
        </div>
        <div class="row row-cols-4 row-cols-sm-4 row-cols-md-4 g-4">
            <div class="card card-1" style="width: 18rem;margin-left:40px;">
                <div class="card-body">
                    <h5 class="card-title">Date: @nearesDate<br/>Time: @nearesTime</h5>
                    <p class="card-text">Doctor:
                        <a type="button" id="details-btn" class="btn btn-sm btn-outline-light" asp-controller="Doctors"
                           asp-action="Details" asp-route-id="@nearestAppointment.DoctorId">
                            @nearestDoctorFullName
                        </a>
                    </p>
                    <p class="card-text">Specialization: @nearesDoctorSpec</p>
                    <p class="card-text">Status: Planned</p>
                </div>
            </div>
        </div>
            <br/>
            <hr/>
    }
    
    @if(!currentAppointments.IsNullOrEmpty())
    {
        <div class="row">
            <h2>Current</h2>
        </div>
        <div class="row row-cols-4 row-cols-sm-4 row-cols-md-4 g-4">
            @foreach (var appointment in currentAppointments)
        {
            var doctorFullName = $"{appointment.Doctor.Surname} {appointment.Doctor.Name} {appointment.Doctor.MiddleName}";
            var doctorSpec = appointment.Doctor.Specialization;
            var date = appointment.AppointmentDate.Date.ToString("dd.MM.yyyy");
            var time = appointment.AppointmentTime.ToString();

            <div class="card-current" style="width: 18rem;margin-left:40px;">
                <div class="card-body">
                    <h5 class="card-title">Date: @date<br/>Time: @time</h5>
                    <p class="card-text">Doctor:
                        <a type="button" id="details-btn" class="btn btn-sm btn-outline-light" asp-controller="Doctors"
                           asp-action="Details" asp-route-id="@appointment.DoctorId">
                            @doctorFullName
                        </a>
                    </p>
                    <p class="card-text">Specialization: @doctorSpec</p>
                    <p class="card-text">Status: In progress</p>
                </div>
            </div>

        }            
        </div>
        <br/>
        <hr/>
    }
    
    @if (!plannedAppointments.IsNullOrEmpty())
    {
        <div class="row">
            <h2>Planned</h2>
        </div>
        <div class="row row-cols-4 row-cols-sm-4 row-cols-md-4 g-4">
            @foreach (var appointment in plannedAppointments)
        {
            var doctorFullName = $"{appointment.Doctor.Surname} {appointment.Doctor.Name} {appointment.Doctor.MiddleName}";
            var doctorSpec = appointment.Doctor.Specialization;
            var date = appointment.AppointmentDate.Date.ToString("dd.MM.yyyy");
            var time = appointment.AppointmentTime.ToString();

            <div class="card card-1" style="width: 18rem;margin-left:40px;">
                <div class="card-body">
                    <h5 class="card-title">Date: @date<br/>Time: @time</h5>
                    <p class="card-text">Doctor:
                        <a type="button" id="details-btn" class="btn btn-sm btn-outline-light" asp-controller="Doctors"
                           asp-action="Details" asp-route-id="@appointment.DoctorId">
                            @doctorFullName
                        </a>
                    </p>
                    <p class="card-text">Specialization: @doctorSpec</p>
                    <p class="card-text">Status: Planned</p>
                </div>
            </div>
        }        
        </div>
        <br/>
        <hr/>
    }
       
    @if (!finishedAppointments.IsNullOrEmpty())
    {
        <div class="row">
            <h2>Finished</h2>
        </div>
        <div class="row row-cols-4 row-cols-sm-4 row-cols-md-4 g-4">
        @foreach (var appointment in finishedAppointments)
        {
            var doctorFullName = $"{appointment.Doctor.Surname} {appointment.Doctor.Name} {appointment.Doctor.MiddleName}";
            var doctorSpec = appointment.Doctor.Specialization;
            var date = appointment.AppointmentDate.Date.ToString("dd.MM.yyyy");
            var time = appointment.AppointmentTime.ToString();

            <div class="card-finished" style="width: 18rem;margin-left:40px;">
                <div class="card-body">
                    <h5 class="card-title">Date: @date<br/>Time: @time</h5>
                    <p class="card-text">Doctor:
                        <a type="button" id="details-btn" class="btn btn-sm btn-outline-light" asp-controller="Doctors"
                           asp-action="Details" asp-route-id="@appointment.DoctorId">
                            @doctorFullName
                        </a>
                    </p>
                    <p class="card-text">Specialization: @doctorSpec</p>
                    <p class="card-text">Status: Finished</p>
                </div>
            </div>
        }
        </div>
        <br/>
        <hr/>
    }
</div>
  

<script src="~/js/site.js"></script>